<section>
    <h2>Canary ausrollen</h2>
    <div>
        <pre data-id="code-animation"><code style="font-size:1rem;" class="language-console" data-trim>
            # Version 'canary' ausrollen
            $ k apply -f k8s-demo-canary.yaml
            deployment.apps/k8s-demo-canary created
            service/k8s-demo-canary-svc created
        </code></pre>
    </div>
</section>
<section>
    <h2>HTTPRoute Manifest</h2>
    <pre data-id="code-animation"><code data-line-numbers="2,4|15|22-24|25-27" class="language-yaml" data-trim>
apiVersion: gateway.networking.k8s.io/v1beta1
kind: HTTPRoute
metadata:
  name: k8s-demo-canary-httproute
  labels:
    app: k8s-demo-canary
    app.kubernetes.io/name: k8s-demo-canary-httproute
    app.kubernetes.io/component: server
spec:
  parentRefs:
    - name: traefik-gateway
      namespace: traefik
      sectionName: web
  hostnames:
    - canary.MEINE-VM.nerdapp.work
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /
      backendRefs:
        - name: k8s-demo-vx-svc
          port: 80
          weight: 80  # 80% der Anfragen an k8s-demo-vx-svc
        - name: k8s-demo-canary-svc
          port: 80
          weight: 20  # 20% der Anfragen an k8s-demo-canary-svc
    </code></pre>
</section>
<section>
    <h2>HTTPRoute ausrollen</h2>
    <div>
        <pre data-id="code-animation"><code style="font-size:1rem;" class="language-console" data-trim>
            # HTTPRoute anlegen mit Aufteilung zwischen Services 80/20
            $ k apply -f k8s-demo-canary-httproute.yaml
        </code></pre>
    </div>
    <div class="fragment" style="font-size: 2rem">
        <p>Im Browser mehrmals aufrufen<br>
            <a href="http://canary.MEINE-VM.nerdapp.work/" target="_blank">http://canary.MEINE-VM.nerdapp.work/</a>
        </p>
    </div>
    <div class="fragment">
        <pre data-id="code-animation"><code style="font-size:1rem;" class="language-console" data-trim>
            # Anwendung mittels Schleife aufrufen
            $ ./get-loop.sh canary
        </code></pre>
        <pre data-id="code-animation"><code style="font-size:1rem;" class="language-json" data-trim>
{"host":"k8s-demo-vx-56bc795557-stkt2",...,"version":"v2","totalRequests":234,...}
{"host":"k8s-demo-vx-56bc795557-v5rs9",...,"version":"v2","totalRequests":236,...}
{"host":"k8s-demo-vx-56bc795557-vfjdv",...,"version":"v2","totalRequests":238,...}
{"host":"k8s-demo-vx-56bc795557-4p99r",...,"version":"v2","totalRequests":237,...}
{"host":"k8s-demo-canary-5c76669fc-5mx52",...,"version":"canary","totalRequests":30,...}
{"host":"k8s-demo-vx-56bc795557-stkt2",...,"version":"v2","totalRequests":235,...}
{"host":"k8s-demo-vx-56bc795557-v5rs9",...,"version":"v2","totalRequests":237,...}
{"host":"k8s-demo-vx-56bc795557-vfjdv",...,"version":"v2","totalRequests":239,...}
{"host":"k8s-demo-vx-56bc795557-4p99r",...,"version":"v2","totalRequests":238,...}
{"host":"k8s-demo-canary-5c76669fc-5mx52",...,"version":"canary","totalRequests":31,...}
{"host":"k8s-demo-vx-56bc795557-stkt2",...,"version":"v2","totalRequests":236,...}
        </code></pre>
    </div>
</section>
